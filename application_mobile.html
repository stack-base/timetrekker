<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>TimeTrekker Mobile</title>
<link rel="icon" href="https://stack-base.github.io/media/brand/timetrekker/timetrekker-icon.png" type="image/x-icon">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: { sans: ['Inter', 'sans-serif'] },
                colors: {
                    brand: { DEFAULT: '#ff5757', hover: '#e04848', dim: '#4a1a1a' },
                    dark: { bg: '#000000', sidebar: '#000000', card: '#121212', active: '#1e1e1e', border: '#2a2a2a' },
                    text: { main: '#ffffff', muted: '#a1a1aa', faint: '#525252' }
                },
                screens: { 'xs': '375px' }
            }
        }
    };
</script>

<style>
    /* Mobile Performance & Reset */
    body { background-color: #000000; color: #ffffff; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
    ::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .safe-pb { padding-bottom: env(safe-area-inset-bottom, 20px); }
    .safe-pt { padding-top: env(safe-area-inset-top, 20px); }
    
    /* Animations */
    .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    
    /* Sheet Handle */
    .sheet-handle { width: 36px; height: 4px; background: #333333; border-radius: 99px; margin: 8px auto 16px; }
    
    /* Range Slider */
    input[type=range] { -webkit-appearance: none; background: transparent; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #ff5757; margin-top: -8px; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333333; border-radius: 2px; }

    /* Glass Effect for Bottom Nav */
    .glass-nav { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-top: 1px solid #2a2a2a; }
</style>

<script type="module" src="mobile.js" defer></script>
</head>
<body class="h-[100dvh] w-full overflow-hidden flex flex-col relative">

    <div id="toast-container" class="fixed top-6 left-1/2 -translate-x-1/2 z-[100] w-[90%] max-w-sm pointer-events-none flex flex-col gap-2"></div>

    <div id="custom-prompt-modal" class="fixed inset-0 z-[110] bg-black/80 hidden opacity-0 transition-opacity flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-dark-card border border-dark-border w-full max-w-sm rounded-xl p-6 shadow-2xl transform scale-100">
            <h3 id="prompt-title" class="text-lg font-bold text-white mb-4">Enter Value</h3>
            <input type="text" id="prompt-input" class="w-full bg-dark-bg border border-dark-border text-white rounded-lg px-4 py-3 outline-none focus:border-brand transition-colors text-base mb-6" autocomplete="off">
            <div class="flex justify-end space-x-3">
                <button id="prompt-cancel-btn" class="text-text-muted hover:text-white text-sm font-medium px-4 py-2">Cancel</button>
                <button id="prompt-confirm-btn" class="bg-brand text-white px-5 py-2 rounded-lg text-sm font-bold shadow-md active:scale-95 transition-transform">Save</button>
            </div>
        </div>
    </div>

    <main class="flex-1 relative overflow-hidden bg-dark-bg">

        <div id="view-tasks" class="view-section absolute inset-0 flex flex-col">
            <header class="safe-pt px-5 py-4 flex items-center justify-between bg-dark-bg z-10">
                <div class="flex flex-col">
                    <span id="current-date" class="text-xs font-bold text-brand uppercase tracking-wider mb-0.5">Today</span>
                    <h1 id="page-title" class="text-2xl font-bold text-white tracking-tight">Today</h1>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="app.refreshApp()" class="w-8 h-8 rounded-full bg-dark-active flex items-center justify-center text-text-muted active:text-white transition-colors"><i class="ph-bold ph-arrows-clockwise"></i></button>
                    <div id="header-avatar" class="w-8 h-8 rounded-full bg-gradient-to-br from-brand to-red-600 flex items-center justify-center text-xs font-bold text-white ring-2 ring-dark-bg relative overflow-hidden">
                        U <img id="header-avatar-img" class="absolute inset-0 w-full h-full object-cover hidden">
                    </div>
                </div>
            </header>

            <div class="px-5 pb-2">
                <div class="bg-dark-card border border-dark-border rounded-xl p-3 flex items-center justify-between shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-brand/10 flex items-center justify-center text-brand"><i class="ph-fill ph-clock"></i></div>
                        <div>
                            <div id="mini-est-time" class="text-sm font-bold text-white">0m</div>
                            <div class="text-[10px] text-text-muted uppercase">Est. Time</div>
                        </div>
                    </div>
                    <div class="h-6 w-px bg-dark-border"></div>
                    <div class="flex items-center gap-3">
                        <div>
                            <div id="mini-tasks-left" class="text-sm font-bold text-white text-right">0</div>
                            <div class="text-[10px] text-text-muted uppercase text-right">Tasks Left</div>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-500"><i class="ph-fill ph-check-circle"></i></div>
                    </div>
                </div>
            </div>

            <div class="w-full overflow-x-auto no-scrollbar py-2 px-5 flex gap-2" id="task-filters">
                <button onclick="app.openProjectSheet()" id="filter-folders" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-dark-active text-text-muted border border-dark-border flex items-center gap-2 active:bg-dark-border transition-colors">
                    <i class="ph-bold ph-folders"></i> Projects
                </button>
                <button onclick="app.setFilter('today')" id="filter-today" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-brand text-white transition-colors">Today</button>
                <button onclick="app.setFilter('tomorrow')" id="filter-tomorrow" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-dark-active text-text-muted transition-colors">Tomorrow</button>
                <button onclick="app.setFilter('upcoming')" id="filter-upcoming" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-dark-active text-text-muted transition-colors">Upcoming</button>
                <button onclick="app.setFilter('all')" id="filter-all" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-dark-active text-text-muted transition-colors">All Tasks</button>
                <button onclick="app.setFilter('completed')" id="filter-completed" class="whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-dark-active text-text-muted transition-colors">Completed</button>
            </div>

            <div class="flex-1 overflow-y-auto overflow-x-hidden px-5 py-2 pb-24 space-y-3 relative" id="task-list">
                <div id="empty-state" class="absolute inset-0 flex flex-col items-center justify-center text-text-faint pb-20 pointer-events-none">
                    <i class="ph-duotone ph-check-square-offset text-6xl mb-4 opacity-50"></i>
                    <p class="text-sm font-medium text-text-muted">No tasks found</p>
                    <p class="text-xs mt-1">Add a task to get started.</p>
                </div>
            </div>
            
            <button id="fab-add" onclick="app.openTaskModal()" class="absolute bottom-6 right-5 w-14 h-14 bg-brand text-white rounded-full shadow-lg shadow-brand/30 flex items-center justify-center active:scale-90 transition-transform z-20">
                <i class="ph-bold ph-plus text-2xl"></i>
            </button>
        </div>

        <div id="view-timer" class="view-section hidden absolute inset-0 flex flex-col bg-dark-bg z-20">
             <div class="flex-1 flex flex-col items-center justify-center p-8 relative">
                
                <div class="mb-12 w-full text-center min-h-[100px] flex flex-col items-center justify-center">
                    <div id="focus-empty" class="text-text-muted animate-pulse flex flex-col items-center gap-2">
                         <i class="ph-duotone ph-coffee text-4xl mb-2"></i>
                         <p class="text-sm font-medium">Select a task to focus</p>
                    </div>
                    <div id="focus-active" class="hidden w-full flex flex-col items-center animate-slide-up">
                        <div class="inline-flex items-center justify-center px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-dark-active text-brand border border-brand/20 mb-4">
                            <span id="timer-badge">Project</span>
                        </div>
                        <h2 id="timer-task-title" class="text-2xl font-bold text-white leading-tight mb-2 text-center line-clamp-2 px-4">Task Title</h2>
                        <div class="flex items-center gap-2 text-xs text-text-muted">
                            <span class="text-brand font-bold" id="timer-completed">0</span>
                            <span>/</span>
                            <span id="timer-total">4</span>
                            <span>Pomos</span>
                        </div>
                    </div>
                </div>

                <div class="relative mb-16">
                    <div class="relative w-72 h-72 flex items-center justify-center">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="46" fill="none" stroke="#1a1a1a" stroke-width="2"/>
                            <circle id="timer-progress" cx="50" cy="50" r="46" fill="none" stroke="#ff5757" stroke-width="2" stroke-linecap="round" stroke-dasharray="289" stroke-dashoffset="0" class="transition-all duration-1000 ease-linear"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center cursor-pointer select-none" onclick="app.toggleTimer()">
                            <div id="timer-display" class="text-7xl font-light text-white tracking-tighter tabular-nums">25:00</div>
                            <div id="timer-mode" class="text-xs font-bold tracking-widest uppercase mt-4 text-brand">FOCUS</div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center justify-center gap-8">
                     <button onclick="app.resetTimer()" class="p-4 rounded-full text-text-muted hover:text-white bg-dark-active active:bg-dark-border transition-colors"><i class="ph-bold ph-arrow-counter-clockwise text-2xl"></i></button>
                     <button onclick="app.toggleTimer()" class="w-20 h-20 rounded-full bg-brand text-white flex items-center justify-center active:scale-95 transition-transform shadow-xl shadow-brand/20">
                        <i id="play-icon" class="ph-fill ph-play text-4xl ml-1"></i>
                     </button>
                     <button onclick="app.skipTimer()" class="p-4 rounded-full text-text-muted hover:text-white bg-dark-active active:bg-dark-border transition-colors"><i class="ph-bold ph-skip-forward text-2xl"></i></button>
                </div>
            </div>

            <div class="px-6 py-8 safe-pb flex justify-center gap-4">
                 <button onclick="app.setSound('none')" id="btn-sound-none" class="text-brand p-1"><i class="ph-fill ph-speaker-slash text-xl"></i></button>
                 <button onclick="app.setSound('rain')" id="btn-sound-rain" class="text-text-muted p-1"><i class="ph-fill ph-cloud-rain text-xl"></i></button>
                 <button onclick="app.setSound('cafe')" id="btn-sound-cafe" class="text-text-muted p-1"><i class="ph-fill ph-coffee text-xl"></i></button>
                 <button onclick="app.setSound('forest')" id="btn-sound-forest" class="text-text-muted p-1"><i class="ph-fill ph-tree text-xl"></i></button>
            </div>
            <audio id="audio-player" loop></audio>
        </div>

        <div id="view-analytics" class="view-section hidden absolute inset-0 flex flex-col overflow-y-auto custom-scrollbar bg-dark-bg pb-24">
             <header class="safe-pt px-6 py-6 bg-dark-bg z-10">
                <h1 class="text-2xl font-bold text-white mb-1">Analytics</h1>
                <p class="text-sm text-text-muted">Your productivity insights</p>
                <div class="flex bg-dark-card border border-dark-border rounded-lg p-1 mt-6">
                    <button onclick="app.setRange('week')" id="btn-range-week" class="flex-1 py-1.5 rounded text-xs font-medium bg-brand text-white shadow-sm transition-all">Week</button>
                    <button onclick="app.setRange('month')" id="btn-range-month" class="flex-1 py-1.5 rounded text-xs font-medium text-text-muted transition-all">Month</button>
                    <button onclick="app.setRange('year')" id="btn-range-year" class="flex-1 py-1.5 rounded text-xs font-medium text-text-muted transition-all">Year</button>
                </div>
            </header>

            <div class="px-6 space-y-4 pb-10">
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                        <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Total Focus</div>
                        <div class="text-2xl font-bold text-brand" id="ana-time-total">0h</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                        <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Completion</div>
                        <div class="text-2xl font-bold text-green-500" id="ana-completion-rate">0%</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                        <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Tasks Done</div>
                        <div class="text-xl font-bold text-blue-500" id="ana-task-total">0</div>
                    </div>
                    <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                        <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Streak</div>
                        <div class="text-xl font-bold text-purple-500" id="ana-streak-days">0 Days</div>
                    </div>
                </div>

                <div class="bg-dark-card border border-dark-border rounded-xl p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white">Focus Trend</h3>
                         <div class="flex bg-dark-bg rounded-md p-0.5 border border-dark-border">
                            <button onclick="app.toggleChartType('focus', 'line')" id="btn-focus-line" class="px-3 py-1 text-[10px] font-bold rounded-md text-text-muted transition-colors">Line</button>
                            <button onclick="app.toggleChartType('focus', 'bar')" id="btn-focus-bar" class="px-3 py-1 text-[10px] font-bold rounded-md bg-dark-card text-white shadow-sm transition-colors">Bar</button>
                        </div>
                    </div>
                    <div class="h-[200px] w-full"><canvas id="focusBarChart"></canvas></div>
                </div>

                 <div class="bg-dark-card border border-dark-border rounded-xl p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-white">Hourly Activity</h3>
                    </div>
                    <div class="h-[200px] w-full"><canvas id="hourlyChart"></canvas></div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                         <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">This Week</div>
                         <div class="text-lg font-bold text-white" id="ana-time-week">0m</div>
                    </div>
                     <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                         <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Today</div>
                         <div class="text-lg font-bold text-white" id="ana-time-today">0m</div>
                    </div>
                     <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                         <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Week Tasks</div>
                         <div class="text-lg font-bold text-white" id="ana-task-week">0</div>
                    </div>
                     <div class="bg-dark-card border border-dark-border rounded-xl p-4">
                         <div class="text-[10px] text-text-muted font-bold uppercase tracking-wider mb-2">Today Tasks</div>
                         <div class="text-lg font-bold text-white" id="ana-task-today">0</div>
                    </div>
                </div>
                
                <div class="bg-brand/5 border border-brand/20 rounded-xl p-4 flex gap-3">
                    <i class="ph-fill ph-lightbulb text-brand text-xl shrink-0"></i>
                    <div>
                        <h4 class="text-sm font-bold text-white mb-1">Smart Insight</h4>
                        <p id="insight-text" class="text-xs text-text-muted leading-relaxed">Not enough data yet.</p>
                    </div>
                </div>

                 <div class="bg-dark-card border border-dark-border rounded-xl p-5">
                    <h3 class="text-sm font-bold text-white mb-4">Project Distribution</h3>
                    <div class="h-[180px] w-full mb-4 flex justify-center"><canvas id="projectChart"></canvas></div>
                    <div id="project-legend" class="space-y-2 text-xs"></div>
                </div>

                 <div class="bg-dark-card border border-dark-border rounded-xl overflow-hidden">
                     <div class="p-4 border-b border-dark-border bg-dark-active/30"><h3 class="text-sm font-bold text-white">Recent Sessions</h3></div>
                     <div id="mobile-logs" class="divide-y divide-dark-border"></div>
                </div>

            </div>
        </div>

        <div id="view-settings" class="view-section hidden absolute inset-0 flex flex-col bg-dark-bg">
             <header class="safe-pt px-6 py-6 border-b border-dark-border z-10">
                <h1 class="text-2xl font-bold text-white">Settings</h1>
            </header>
            <div class="flex-1 overflow-y-auto p-6 space-y-8 pb-24">
                
                <div class="flex items-center gap-4">
                    <div id="settings-avatar" class="w-16 h-16 rounded-full bg-gradient-to-br from-brand to-red-600 flex items-center justify-center text-2xl font-bold text-white shadow-lg overflow-hidden relative">
                         U <img id="settings-avatar-img" class="absolute inset-0 w-full h-full object-cover hidden">
                    </div>
                    <div>
                        <h2 id="settings-name" class="text-lg font-bold text-white">User</h2>
                        <p id="settings-email" class="text-sm text-text-muted">email@example.com</p>
                    </div>
                </div>

                <div>
                    <h3 class="text-xs font-bold text-text-muted uppercase tracking-wider mb-4">Timer Configuration</h3>
                    <div class="bg-dark-card border border-dark-border rounded-xl divide-y divide-dark-border">
                        
                        <div class="p-4">
                            <div class="flex justify-between mb-2">
                                <span class="text-sm text-white font-medium">Focus Duration</span>
                                <span class="text-sm text-brand font-bold" id="set-focus-display">25m</span>
                            </div>
                            <input type="range" min="5" max="60" step="5" value="25" class="w-full" oninput="app.updateSetting('focus', this.value); document.getElementById('set-focus-display').innerText = this.value+'m'">
                        </div>

                        <div class="p-4">
                            <div class="flex justify-between mb-2">
                                <span class="text-sm text-white font-medium">Short Break</span>
                                <span class="text-sm text-blue-400 font-bold" id="set-short-display">5m</span>
                            </div>
                            <input type="range" min="1" max="15" step="1" value="5" class="w-full" oninput="app.updateSetting('short', this.value); document.getElementById('set-short-display').innerText = this.value+'m'">
                        </div>

                         <div class="p-4">
                            <div class="flex justify-between mb-2">
                                <span class="text-sm text-white font-medium">Long Break</span>
                                <span class="text-sm text-blue-400 font-bold" id="set-long-display">15m</span>
                            </div>
                            <input type="range" min="10" max="45" step="5" value="15" class="w-full" oninput="app.updateSetting('long', this.value); document.getElementById('set-long-display').innerText = this.value+'m'">
                        </div>

                        <div class="p-4 flex items-center justify-between">
                            <div>
                                <span class="text-sm text-white font-medium block">Long Break Interval</span>
                                <span class="text-xs text-text-muted">Sessions before long break</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-white font-bold" id="set-long-interval-display">4x</span>
                                <input id="inp-long-interval" type="range" min="2" max="10" step="1" value="4" class="w-24" oninput="app.updateSetting('longBreakInterval', this.value); document.getElementById('set-long-interval-display').innerText = this.value+'x'">
                            </div>
                        </div>

                    </div>
                </div>

                <div class="bg-dark-card border border-dark-border rounded-xl divide-y divide-dark-border">
                    <div class="p-4 flex items-center justify-between">
                         <span class="text-sm text-white font-medium">Auto-start Pomodoro</span>
                         <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-auto-pomo" class="sr-only peer" onchange="app.updateSetting('autoStartPomo', this.checked)">
                            <div class="w-11 h-6 bg-dark-active peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand"></div>
                        </label>
                    </div>
                    <div class="p-4 flex items-center justify-between">
                         <span class="text-sm text-white font-medium">Auto-start Break</span>
                         <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-auto-break" class="sr-only peer" onchange="app.updateSetting('autoStartBreak', this.checked)">
                            <div class="w-11 h-6 bg-dark-active peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand"></div>
                        </label>
                    </div>
                     <div class="p-4 flex items-center justify-between">
                         <span class="text-sm text-white font-medium">Strict Mode</span>
                         <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-strict" class="sr-only peer" onchange="app.updateSetting('strictMode', this.checked)">
                            <div class="w-11 h-6 bg-dark-active peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand"></div>
                        </label>
                    </div>
                </div>

                <button onclick="app.signOut()" class="w-full py-4 rounded-xl border border-red-500/20 text-red-500 font-bold bg-red-500/5 hover:bg-red-500/10 transition-colors">Sign Out</button>

                <div class="text-center text-xs text-text-faint pb-8">
                    <p>TimeTrekker Mobile v1.0.0</p>
                    <p>&copy; 2025 StackBase</p>
                </div>
            </div>
        </div>

    </main>

    <nav class="glass-nav h-[80px] safe-pb flex justify-around items-center px-2 z-50 shrink-0">
        <button onclick="app.switchTab('tasks')" id="tab-tasks" class="nav-item flex flex-col items-center justify-center w-full h-full text-brand transition-colors">
            <i class="ph-fill ph-check-square text-2xl mb-1"></i>
            <span class="text-[10px] font-medium">Tasks</span>
        </button>
        <button onclick="app.switchTab('timer')" id="tab-timer" class="nav-item flex flex-col items-center justify-center w-full h-full text-text-muted transition-colors">
            <i class="ph-bold ph-timer text-2xl mb-1"></i>
            <span class="text-[10px] font-medium">Timer</span>
        </button>
        <button onclick="app.switchTab('analytics')" id="tab-analytics" class="nav-item flex flex-col items-center justify-center w-full h-full text-text-muted transition-colors">
            <i class="ph-bold ph-chart-bar text-2xl mb-1"></i>
            <span class="text-[10px] font-medium">Stats</span>
        </button>
        <button onclick="app.switchTab('settings')" id="tab-settings" class="nav-item flex flex-col items-center justify-center w-full h-full text-text-muted transition-colors">
            <i class="ph-bold ph-gear text-2xl mb-1"></i>
            <span class="text-[10px] font-medium">Settings</span>
        </button>
    </nav>

    <div id="modal-overlay" onclick="app.closeAllSheets()" class="fixed inset-0 bg-black/80 z-[60] hidden opacity-0 transition-opacity backdrop-blur-sm"></div>

    <div id="project-sheet" class="fixed inset-x-0 bottom-0 z-[70] bg-dark-card rounded-t-2xl transform translate-y-full transition-transform duration-300 max-h-[80vh] flex flex-col border-t border-dark-border">
        <span class="sheet-handle"></span>
        <div class="px-5 pb-4 border-b border-dark-border flex justify-between items-center">
            <h3 class="text-lg font-bold text-white">Select Project</h3>
            <button onclick="app.promptNewProject()" class="text-brand font-bold text-sm"><i class="ph-bold ph-plus mr-1"></i>New</button>
        </div>
        <div class="overflow-y-auto flex-1 p-0" id="project-sheet-list"></div>
        <div class="safe-pb bg-dark-card"></div>
    </div>

    <div id="modal-sheet" class="fixed inset-x-0 bottom-0 z-[80] bg-dark-card rounded-t-2xl transform translate-y-full transition-transform duration-300 h-[92vh] flex flex-col border-t border-dark-border shadow-2xl">
        
        <div class="px-5 py-4 border-b border-dark-border flex justify-between items-center bg-dark-card z-10 rounded-t-2xl">
            <button onclick="app.closeTaskModal()" class="text-text-muted hover:text-white">Cancel</button>
            <h3 id="sheet-title" class="text-base font-bold text-white">New Task</h3>
            <button onclick="app.saveTask()" id="btn-save-task" class="text-brand font-bold">Save</button>
        </div>

        <div class="flex-1 overflow-y-auto p-5 space-y-6">
            
            <div>
                <input type="text" id="inp-title" placeholder="What needs to be done?" class="w-full bg-transparent text-xl font-medium text-white placeholder-text-muted border-none outline-none mb-3" autocomplete="off">
                <textarea id="inp-note" rows="2" placeholder="Add notes..." class="w-full bg-transparent text-sm text-text-muted border-none outline-none resize-none"></textarea>
            </div>

            <div>
                 <label class="text-xs font-bold text-text-muted uppercase mb-2 block">Due Date</label>
                 <div class="flex gap-2 mb-2">
                     <button id="btn-date-today" onclick="app.setQuickDate('today')" class="flex-1 py-2 rounded-lg bg-brand text-white border border-brand text-xs font-bold shadow-md transition-all">Today</button>
                     <button id="btn-date-tomorrow" onclick="app.setQuickDate('tomorrow')" class="flex-1 py-2 rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-text-muted transition-all active:scale-95">Tomorrow</button>
                     <div class="relative flex-1">
                         <input type="date" id="inp-date" onchange="app.highlightDateButton(this.value)" class="absolute inset-0 opacity-0 z-10 w-full h-full">
                         <button id="btn-date-pick" class="w-full h-full rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-text-muted flex items-center justify-center transition-all active:scale-95">
                             <i class="ph-bold ph-calendar mr-1"></i> <span id="lbl-date-pick">Pick</span>
                         </button>
                     </div>
                 </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                 <div class="bg-dark-active/50 p-3 rounded-xl border border-dark-border">
                    <label class="text-[10px] font-bold text-text-muted uppercase mb-2 block">Est. Pomodoros</label>
                    <div class="flex items-center justify-between">
                        <button onclick="app.adjustEst(-1)" class="w-8 h-8 rounded-full bg-dark-card border border-dark-border text-text-muted active:text-white"><i class="ph-bold ph-minus"></i></button>
                        <span id="disp-est" class="text-xl font-bold text-white">1</span>
                        <button onclick="app.adjustEst(1)" class="w-8 h-8 rounded-full bg-dark-card border border-dark-border text-text-muted active:text-white"><i class="ph-bold ph-plus"></i></button>
                    </div>
                </div>
                 <div class="bg-dark-active/50 p-3 rounded-xl border border-dark-border">
                    <label class="text-[10px] font-bold text-text-muted uppercase mb-2 block">Duration</label>
                    <select id="inp-duration" onchange="app.updateDurationDisplay(this.value)" class="w-full bg-dark-card text-white text-sm border border-dark-border rounded-lg p-1.5 outline-none">
                        <option value="15">15 min</option>
                        <option value="25" selected>25 min</option>
                        <option value="30">30 min</option>
                        <option value="45">45 min</option>
                        <option value="60">60 min</option>
                    </select>
                    <div class="text-right text-[10px] text-text-muted mt-1" id="disp-duration">25m</div>
                </div>
            </div>
            <div class="text-center text-xs text-brand font-bold bg-brand/5 py-1.5 rounded border border-brand/10" id="total-calc-display">25m Total</div>

            <div>
                <label class="text-xs font-bold text-text-muted uppercase mb-2 block">Priority</label>
                <div class="grid grid-cols-4 gap-2">
                    <button id="btn-pri-none" onclick="app.setPriority('none')" class="h-9 rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-text-muted">None</button>
                    <button id="btn-pri-low" onclick="app.setPriority('low')" class="h-9 rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-blue-500">Low</button>
                    <button id="btn-pri-med" onclick="app.setPriority('med')" class="h-9 rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-yellow-500">Med</button>
                    <button id="btn-pri-high" onclick="app.setPriority('high')" class="h-9 rounded-lg bg-dark-card border border-dark-border text-xs font-medium text-red-500">High</button>
                </div>
                <input type="hidden" id="inp-priority" value="none">
            </div>

            <div class="space-y-4">
                 <div>
                    <label class="text-xs font-bold text-text-muted uppercase mb-2 block">Project</label>
                    <div class="relative">
                        <select id="inp-project" class="w-full h-10 bg-dark-bg border border-dark-border text-white text-sm rounded-lg px-3 outline-none appearance-none"></select>
                        <i class="ph-bold ph-caret-down absolute right-3 top-3 text-text-muted pointer-events-none"></i>
                    </div>
                </div>
                <div>
                    <label class="text-xs font-bold text-text-muted uppercase mb-2 block">Tags</label>
                    <input type="text" id="inp-tags" placeholder="e.g. Work, Design (comma separated)" class="w-full h-10 bg-dark-bg border border-dark-border text-white text-sm rounded-lg px-3 outline-none">
                </div>
            </div>

            <div class="bg-dark-active/30 border border-dark-border rounded-xl p-4 space-y-4">
                 <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-text-muted uppercase">Subtasks</label>
                        <button onclick="app.addSubtaskInput()" class="text-xs text-brand font-bold"><i class="ph-bold ph-plus"></i> Add</button>
                    </div>
                    <div id="subtask-list" class="space-y-2"></div>
                </div>
                <div class="grid grid-cols-2 gap-4 pt-2 border-t border-dark-border/50">
                    <div>
                        <label class="text-[10px] font-bold text-text-muted uppercase mb-1 block">Repeat</label>
                        <select id="inp-repeat" class="w-full bg-dark-bg text-white text-xs border border-dark-border rounded px-2 py-1.5 outline-none">
                            <option value="none">None</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="weekdays">Weekdays</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-text-muted uppercase mb-1 block">Reminder</label>
                        <input type="time" id="inp-reminder" class="w-full bg-dark-bg text-white text-xs border border-dark-border rounded px-2 py-1.5 outline-none">
                    </div>
                </div>
            </div>

            <div class="safe-pb h-10"></div>
        </div>
    </div>

    <div id="detail-sheet" class="fixed inset-x-0 bottom-0 z-[90] bg-dark-card rounded-t-2xl transform translate-y-full transition-transform duration-300 max-h-[90vh] flex flex-col border-t border-dark-border shadow-2xl">
        <span class="sheet-handle"></span>
        <div class="flex-1 overflow-y-auto px-6 pb-6 pt-2">
            
            <div class="flex justify-between items-start mb-1">
                <span id="dt-project" class="text-xs font-bold text-brand bg-brand/10 px-2 py-1 rounded border border-brand/20">Project</span>
                <span id="dt-priority" class="hidden text-[10px] font-bold uppercase">Priority</span>
            </div>

            <h2 id="dt-title" class="text-2xl font-bold text-white mt-3 mb-2 leading-tight">Task Title</h2>
            <p id="dt-note" class="text-text-muted text-sm leading-relaxed mb-6 hidden">Description...</p>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <div class="bg-dark-active p-3 rounded-lg text-center border border-dark-border">
                    <div class="text-[10px] text-text-muted uppercase font-bold">Done</div>
                    <div id="dt-pomo-done" class="text-xl font-bold text-white mt-1">0</div>
                    <div class="text-[10px] text-text-faint mt-1" id="dt-time-spent">0m</div>
                </div>
                <div class="bg-dark-active p-3 rounded-lg text-center border border-dark-border relative overflow-hidden">
                    <div class="absolute inset-0 bg-brand/5"></div>
                    <div class="text-[10px] text-brand uppercase font-bold relative z-10">Left</div>
                    <div id="dt-pomo-left" class="text-xl font-bold text-brand mt-1 relative z-10">4</div>
                    <div class="text-[10px] text-brand/70 mt-1 relative z-10" id="dt-time-left">100m</div>
                </div>
                <div class="bg-dark-active p-3 rounded-lg text-center border border-dark-border">
                    <div class="text-[10px] text-text-muted uppercase font-bold">Total</div>
                    <div id="dt-pomo-total" class="text-xl font-bold text-white mt-1">4</div>
                    <div class="text-[10px] text-text-faint mt-1" id="dt-time-total">100m</div>
                </div>
            </div>

            <div class="space-y-4">
                <div id="dt-subtasks-container" class="hidden">
                    <h4 class="text-xs font-bold text-text-muted uppercase mb-2">Subtasks</h4>
                    <div id="dt-subtasks-list" class="space-y-2 bg-dark-active/30 p-3 rounded-xl border border-dark-border"></div>
                </div>

                <div class="flex items-center gap-2 text-xs text-text-muted">
                    <i class="ph-bold ph-calendar"></i> <span id="dt-date">Date</span>
                </div>

                <div id="dt-tags-container" class="flex flex-wrap gap-2 hidden"></div>
            </div>

        </div>

        <div class="p-4 border-t border-dark-border bg-dark-card safe-pb grid grid-cols-4 gap-3">
             <button onclick="app.startFocusFromDetail()" class="col-span-2 bg-brand text-white rounded-xl py-3 font-bold shadow-lg shadow-brand/20 active:scale-95 transition-transform flex items-center justify-center gap-2">
                <i class="ph-fill ph-play"></i> Focus Now
            </button>
            <button onclick="app.editCurrentTask()" class="col-span-1 bg-dark-active text-white rounded-xl py-3 font-bold border border-dark-border active:scale-95 transition-transform">Edit</button>
            <button onclick="app.deleteCurrentTask()" class="col-span-1 bg-dark-active text-red-500 rounded-xl py-3 font-bold border border-dark-border active:scale-95 transition-transform"><i class="ph-bold ph-trash text-lg"></i></button>
        </div>
    </div>

</body>
</html>